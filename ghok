#!/usr/bin/env python3

import json
import urllib.request

# This program is inspired by the Go implementation by @abennett
# https://github.com/abennett/ghok


def status_icon(status):
    match status:
        case "none" | "operational":
            return "âœ…"
        case "minor" | "degraded_performance":
            return "âš ï¸"
        case "major" | "partial_outage":
            return "ğŸŸ "
        case "critical" | "major_outage":
            return "â›”ï¸"
        case "under_maintenance":
            return "ğŸ”§"
        case _:
            return "â“"


def get(url):
    with urllib.request.urlopen(url) as response:
        return json.loads(response.read())


components_resp = get("https://www.githubstatus.com/api/v2/components.json")
components = [
    component
    for component in components_resp["components"]
    if component["id"] != "0l2p9nhqnxpd"
]

print(f"--- Components as of {components_resp['page']['updated_at']} ---")
for component in components:
    print(f"{status_icon(component['status'])} {component['name']}")


incidents = get("https://www.githubstatus.com/api/v2/incidents/unresolved.json")["incidents"]
if len(incidents) > 0:
    print("\n--- Incidents ---")
    for incident in incidents:
        print(f"\nName:\t{incident['name']}")
        print(f"Impact:\t{status_icon(incident['impact'])}  {incident['impact']}")
        print(f"Status:\t{incident['status']}")
        print(f"Link:\t{incident['shortlink']}")
        print("Updates:")
        for update in incident["incident_updates"]:
            print(f"\n  Status: {update['status']} ({update['updated_at']})")
            print(f"  {update['body']}")
