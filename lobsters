#!/usr/bin/env python3

import json
from pathlib import Path
import urllib.request

config_path = Path(f"{Path.home()}/.config/lobsters/tags")
if config_path.exists():
    with open(config_path) as f:
        tags = f.read().splitlines()
else:
    tags = []

contents = urllib.request.urlopen("https://lobste.rs/hottest").read()
stories = [
  story for story in json.loads(contents)
  if any(tag in story["tags"] for tag in tags) or not tags
]

lines = []

for story in stories:
    lines.append(f"{story['title']} ({story['short_id_url']})\n{story['comment_count']} comments [{', '.join(story['tags'])}]")

print("\n\n".join(lines))
